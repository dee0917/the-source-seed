# PRD - iFreeTime: The Temporal Sovereignty Engine

## 1. 產品概述 (Product Overview)
**iFreeTime** 是一個全球化、跨場景的時間分享與主權管理代理系統。它的宗旨是讓「找出彼此都有空的時間」這件事變得像傳送一個 emoji 一樣簡單。

### 核心場景 (Universal Use Cases)
- **大眾生活與社交 (The Everyman)**：朋友們在群組裡約聚餐，只需丟出一個 iFreeTime 連結，所有人立即看到彼此重疊的空檔，不再需要反覆詢問「你哪天有空？」。
- **專業經紀與助理 (The Professional)**：一鍵生成藝人的「iFreeTime」清單發送給廠商，確保商務安排精確無誤。
- **舞者與創作者 (The Creator)**：根據排練需求，自動從多種日曆中「挖出」符合條件的連續長空檔。
- **跨國協作 (The Global Nomad)**：自動處理不同時區的轉換，讓分隔兩地的家人或團隊一眼看到「共同的清醒時間」。

## 2. 目標用戶 (Target Users)
- **全球所有人**：從約吃飯的大學生到排行程的職業經紀人。
- **跨平台用戶**：同時使用 Google、iCloud 與 Outlook 的現代人。
- **追求簡約者**：不想要複雜的日曆管理，只想知道「何時有空」。

### 3.7 核心隱私與自動化邏輯 (Privacy & Automation Core)

為了徹底解決群組約時間的「手動疲勞」與「隱私焦慮」，**iFreeTime** 實作以下底層邏輯：

1. **零手動同步 (Zero-Manual Sync)**：
   - 只要用戶曾經授權過日曆（Google/iCloud/Outlook），系統會自動在背景維護一份「去識別化」的空閒索引。
   - 當群組發起約會時，系統自動提取相關成員的空閒狀態，無需用戶重複點擊或手動輸入。

2. **絕對隱私屏障 (Absolute Privacy Shield)**：
   - **不可見原則**：任何人（包括群組管理員）都無法看到其他人的日曆細節。系統僅在後端進行「0 與 1」的碰撞運算。
   - **模糊化處理**：輸出的結果僅為「共識區塊」，不顯示誰在何時有具體行程。

3. **主動控制權 (Sovereignty Control)**：
   - **可視範圍設定**：用戶可以預先設定「允許被搜尋的時間段」（例如：僅限週一至週五 18:00 後，或僅限週末）。
   - **一鍵黑名單**：隨時可以對特定群組或個人關閉「自動匹配」功能。

## 4. 痛點解決方案 (Pain-Point Solutions)

| 痛點 | iFreeTime 解決方案 |
| :--- | :--- |
| **反覆確認** | 自動抓取已授權日曆，瞬間算出全體交集。 |
| **隱私洩露** | 僅傳輸空閒布林值，行程內容絕對加密且不可見。 |
| **溝通成本** | 系統主動跳出最優解，不再有「那你呢？」的無效對話。 |
| **時效性** | 日曆實時更新，確保找到的時間絕不衝突。 |

## 3. 功能需求 (Functional Requirements)

### 3.1 核心：智能空閒提取 (Intelligent Slot Extraction)
- **多日曆聚合**：支援從 Google Calendar 等多個來源讀取數據。
- **條件式檢索**：用戶可自定義「專業過濾器」：
  - *時長限制*：找尋不少於 N 分鐘的區塊。
  - *緩衝保護*：自動在行程前後加上「通勤/休息」緩衝。
  - *時段偏好*：排除深夜、週末或特定私人保護時段。
- **情境化輸出**：生成專業、易讀的文字列表或連結，直接發送給第三方。

### 3.2 進階：戰略分析 (Strategic Analysis) - *Nexus 特色*
- **熵值過濾**：自動過濾掉雖然「空閒」但過於碎片（如：夾在兩場會議間的 10 分鐘）的無效時間。
- **能量對齊**：優先推薦位於主人「高效時段」的空檔給最重要的任務。

## 4. 非功能需求 (Non-Functional Requirements)
- **隱私安全**：所有日曆讀取與分析需通過 OpenClaw 的安全隧道，不外洩原始事件內容。
- **低延遲**：分析與生成結果需在 5 秒內完成。
- **多渠道接入**：優先支援 Telegram 交互，未來擴展至 WhatsApp。

## 5. 用戶流程 (User Flow)
1. 用戶在 Telegram 輸入：「幫我找下週三到週五下午，可以給廠商拍片的 3 小時空檔。」
2. **Chronos Nexus** 掃描關聯日曆。
3. 應用「清道夫協議」排除無效碎片。
4. 生成 3 個最優推薦選項，並附帶「建議行動」。
5. 用戶確認後，生成專業的文字邀約：「您好，XX 下週有以下空檔可安排：1. ... 2. ...」

## 6. 成功指標 (Success Metrics)
- **時間減少**：將「找時間」的對話次數減少 70%。
- **主權保護**：減少 50% 的行程衝突與認知疲勞。

## 7. 技術棧 (The Nexus Stack)

### 前端 (The Visual Console)
- **Framework**: Next.js 15 (App Router) - 提供極速的響應與 SSR 效能。
- **Styling**: Tailwind CSS 4 + Shadcn UI - 打造專業、冷峻的戰略控制台風格。
- **Animations**: Framer Motion - 用於處理時間軸滾動與數據展開的流暢感。

### 後端 (The Temporal Logic Layer)
- **Language**: Python 3.12+ (FastAPI) - 高性能、異步處理日曆 API 與數據分析。
- **AI Agent Framework**: **Pydantic AI** - 嚴格的數據校準，確保時間輸出格式絕不出錯。
- **Decision Engine**: **LangGraph** - 處理複雜的「空閒提取 -> 熵值過濾 -> 建議生成」多級工作流。

### 數據與安全 (Infrastructure & Security)
- **Auth**: Google OAuth 2.0 (透過 OpenClaw 安全密鑰存儲管理)。
- **Database**: Supabase (PostgreSQL + pgvector) - 用於儲存「主人認知能量模型」與「歷史偏好」。
- **Tunnel**: Cloudflare Tunnel - 確保本地開發環境與外部 API 的安全通訊。

### 代理接口 (Interface)
- **Control**: Telegram Bot API - 支援自然語言直接下令：「幫我找空檔」。
- **TTS/Voice**: Google Cloud TTS - 提供每日時間戰略報告的語音輸出。

### 7.1 PWA 與原生化體驗 (Mobile App Experience)
為了讓 **Chronos Nexus** 在手機上呈現專業 APP 的質感，我們將導入 **PWA (Progressive Web App)** 體系：
- **Web App Manifest**: 配置精緻的圖標（Icon）、啟動畫面（Splash Screen）與主題顏色。
- **Standalone Mode**: 強制以「獨立視窗」開啟，隱藏瀏覽器網址列，使其與原生 APP 無異。
- **Service Workers**: 實作數據離線快取，確保在網路不穩時依然能讀取已提取的空閒時段。
- **Mobile-First Responsive Design**: 使用 Tailwind CSS 打造底部導航欄（Bottom Nav）與觸控友好的抽屜式組件（Drawers）。
- **Edge-to-Edge Layout**: 適配 iPhone 靈動島與 Android 狀態列，實現全屏沉浸感。

### 3.3 日曆整合規範 (Calendar Integration Standards)
為了確保數據的精確性與即時性，**Chronos Nexus** 僅整合支援標準 API 且穩定性高的知名日曆服務。**若某項服務不支援標準 API 整合，則不予納入系統。**

#### 支援的服務清單 (Supported Services):
- **Google Calendar (核心支援)**:
  - 透過 Google OAuth 2.0 與 Calendar API V3。
  - 支援讀取多個次級日曆 (Secondary Calendars)。
- **Apple iCloud Calendar**:
  - 透過 CalDAV 協議或 App-Specific Passwords。
  - 支援即時同步與全平台 Apple 設備行程讀取。
- **Microsoft Outlook / Office 365**:
  - 透過 Microsoft Graph API。
  - 適用於商務與企業級時間調度需求。

#### 整合邏輯:
- **聚合掃描 (Aggregated Scanning)**: 同時從上述所有已授權服務中抓取時段。
- **排他性處理**: 若 Google 日曆顯示 14:00 忙碌而 iCloud 顯示 14:00 空閒，系統將自動判定該時段為「忙碌」，確保空閒提取零失誤。

---
*Generated by Agent Builder Skill for Chronos Nexus Core.*
